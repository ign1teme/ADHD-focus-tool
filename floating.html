<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸“æ³¨è®¡æ—¶å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* æç®€ç°åº¦é…è‰² - ä¸ä¸»ç•Œé¢ä¸€è‡´ */
            --primary: #e8e8e8;
            --secondary: #f5f5f5;
            --accent: #10b981;
            --warning: #ef4444;
            --bg-main: #ffffff;
            --text: #1f2937;
            --text-muted: #6b7280;
            --border: #e5e7eb;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            background: rgba(255, 255, 255, 0.95);
            color: var(--text);
            height: 100vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            border-radius: 16px;
            border: 1px solid var(--border);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .drag-handle {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 30px;
            -webkit-app-region: drag;
            cursor: move;
            background: var(--secondary);
            border-radius: 14px 14px 0 0;
            border-bottom: 1px solid var(--border);
        }

        .close-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 16px;
            height: 16px;
            background: var(--warning);
            border-radius: 50%;
            cursor: pointer;
            -webkit-app-region: no-drag;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: #fff;
        }

        .timer-container {
            text-align: center;
            margin-top: 20px;
        }

        .timer-circle-container {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 0 auto 20px;
        }

        .timer-circle-svg {
            transform: rotate(-90deg);
            width: 100%;
            height: 100%;
        }

        .timer-circle-bg {
            fill: none;
            stroke: var(--primary);
            stroke-width: 8;
        }

        .timer-circle-progress {
            fill: none;
            stroke: var(--accent);  /* ç»¿è‰²è¿›åº¦æ¡ */
            stroke-width: 8;
            stroke-linecap: round;
            transition: stroke-dashoffset 0.3s linear;
        }

        .timer-display-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .timer-display {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--text);
            font-variant-numeric: tabular-nums;
        }

        .timer-label {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 5px;
        }

        .current-goal {
            font-size: 0.9rem;
            color: var(--text);
            margin: 15px 0;
            padding: 10px;
            background: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 8px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s;
            font-weight: 500;
        }

        .btn-primary {
            background: var(--accent);  /* ç»¿è‰² - ä»…ç”¨äºå¼€å§‹æŒ‰é’® */
            color: #ffffff;
        }

        .btn-primary:hover {
            background: #059669;
            transform: translateY(-1px);
        }

        .btn-secondary {
            background: var(--primary);
            color: var(--text);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: #d1d5db;
        }

        .expand-btn {
            position: absolute;
            bottom: 8px;
            right: 8px;
            padding: 4px 8px;
            background: var(--secondary);
            border: 1px solid var(--border);
            border-radius: 4px;
            color: var(--text);
            font-size: 0.7rem;
            cursor: pointer;
            -webkit-app-region: no-drag;
        }

        .expand-btn:hover {
            background: var(--primary);
        }
    </style>
</head>
<body>
    <div class="drag-handle"></div>
    <div class="close-btn" onclick="window.close()">Ã—</div>

    <div class="timer-container">
        <div class="timer-circle-container">
            <svg class="timer-circle-svg" viewBox="0 0 180 180">
                <circle class="timer-circle-bg" cx="90" cy="90" r="82"></circle>
                <circle class="timer-circle-progress" id="timerCircle" cx="90" cy="90" r="82"></circle>
            </svg>
            <div class="timer-display-overlay">
                <div class="timer-display" id="timerDisplay">25:00</div>
                <div class="timer-label" id="timerLabel">ä¸“æ³¨æ—¶é—´</div>
            </div>
        </div>

        <div class="current-goal" id="currentGoal">è®¾ç½®ä½ çš„ç›®æ ‡...</div>

        <div class="controls">
            <button class="btn btn-primary" id="startBtn" onclick="toggleTimer()">å¼€å§‹</button>
            <button class="btn btn-secondary" onclick="resetTimer()">é‡ç½®</button>
        </div>
    </div>

    <button class="expand-btn" onclick="expandToMain()">å±•å¼€å®Œæ•´ç•Œé¢</button>

    <script>
        // ä»localStorageåŒæ­¥æ•°æ®
        let timerSeconds = 25 * 60;
        let totalSeconds = 25 * 60;
        let timerInterval = null;
        let isRunning = false;

        const timerDisplay = document.getElementById('timerDisplay');
        const timerCircle = document.getElementById('timerCircle');
        const currentGoalEl = document.getElementById('currentGoal');
        const startBtn = document.getElementById('startBtn');

        // åœ†ç¯è¿›åº¦æ¡è®¾ç½®
        const radius = 82;
        const circumference = 2 * Math.PI * radius;
        timerCircle.style.strokeDasharray = circumference;
        timerCircle.style.strokeDashoffset = 0;

        // åŠ è½½ä¿å­˜çš„ç›®æ ‡
        const savedGoal = localStorage.getItem('adhd_goal');
        if (savedGoal) {
            currentGoalEl.textContent = savedGoal;
        }

        function updateTimerDisplay() {
            const mins = Math.floor(timerSeconds / 60);
            const secs = timerSeconds % 60;
            timerDisplay.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;

            const progress = timerSeconds / totalSeconds;
            const offset = circumference * (1 - progress);
            timerCircle.style.strokeDashoffset = offset;
        }

        function toggleTimer() {
            if (isRunning) {
                // æš‚åœ
                clearInterval(timerInterval);
                isRunning = false;
                startBtn.textContent = 'ç»§ç»­';
            } else {
                // å¼€å§‹
                isRunning = true;
                startBtn.textContent = 'æš‚åœ';

                timerInterval = setInterval(() => {
                    if (timerSeconds > 0) {
                        timerSeconds--;
                        updateTimerDisplay();
                    } else {
                        clearInterval(timerInterval);
                        isRunning = false;
                        startBtn.textContent = 'å¼€å§‹';

                        // é€šçŸ¥å®Œæˆ
                        if (Notification.permission === 'granted') {
                            new Notification('ğŸ‰ ä¸“æ³¨æ—¶é—´ç»“æŸï¼', {
                                body: 'å¤ªæ£’äº†ï¼ä¼‘æ¯ä¸€ä¸‹å§ï¼'
                            });
                        }
                    }
                }, 1000);
            }
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerSeconds = 25 * 60;
            totalSeconds = 25 * 60;
            updateTimerDisplay();
            startBtn.textContent = 'å¼€å§‹';
            isRunning = false;
        }

        function expandToMain() {
            if (window.electronAPI) {
                window.electronAPI.switchToMain();
            }
        }

        // è¯·æ±‚é€šçŸ¥æƒé™
        if ('Notification' in window && Notification.permission === 'default') {
            Notification.requestPermission();
        }

        updateTimerDisplay();
    </script>
</body>
</html>
